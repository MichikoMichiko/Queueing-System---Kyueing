@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Office Desk Dashboard";
}
@model IEnumerable<Kyueng.Models.QueueTicket>
<style>
    body {
        background-color: #F7F9FC;
        font-family: 'Poppins', sans-serif;
    }

    h1 {
        text-align: center;
        color: #483D8B;
        font-weight: 600;
        margin-top: 2rem;
        margin-bottom: 2rem;
        font-size: 2.5rem;
    }

    .alert-success {
        max-width: 800px;
        margin: 1rem auto;
        font-size: 1.2rem;
        border-left: 6px solid #28a745;
        background-color: #eafbf0;
        color: #2f5f3b;
    }

    form {
        display: flex;
        justify-content: center;
        margin-bottom: 2rem;
    }

    .btn-danger {
        background-color: #dc3545;
        border: none;
        padding: 0.6rem 1.5rem;
        font-size: 1.1rem;
        border-radius: 0.75rem;
        transition: background-color 0.3s ease, transform 0.2s ease;
    }

        .btn-danger:hover {
            background-color: #c82333;
            transform: translateY(-1px);
        }

    .btn-success {
        background-color: #28a745;
        border: none;
        padding: 0.5rem 1.2rem;
        font-size: 1rem;
        border-radius: 0.75rem;
        margin-right: 0.5rem;
        transition: background-color 0.3s ease;
    }

        .btn-success:hover {
            background-color: #218838;
        }

    .table {
        width: 90%;
        margin: auto;
        background-color: white;
        border-radius: 1rem;
        overflow: hidden;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
    }

        .table thead {
            background-color: #483D8B;
            color: white;
        }

        .table th,
        .table td {
            text-align: center;
            vertical-align: middle;
            padding: 1rem;
            font-size: 1.05rem;
        }

        .table tbody tr:nth-child(even) {
            background-color: #f2f4f8;
        }
</style>

<h1>Office Desk Dashboard</h1>
@{
    var latestCalled = (ViewBag.CalledTickets as List<QueueTicket>)?.FirstOrDefault();
}

@if (latestCalled != null)
{
    <div class="alert alert-success">
        <strong>Currently Called Ticket:</strong> @latestCalled.TicketNumber
    </div>
}
<form>
    <!-- Button to trigger modal -->
    <button type="button" class="btn btn-warning mb-3" data-bs-toggle="modal" data-bs-target="#skippedModal">
        View Skipped Tickets
    </button>

</form>

<table class="table">
    <thead>
        <tr>
            <th>Ticket Number</th>
            <th>Student Name</th>
            <th>Status</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @foreach (var ticket in Model)
        {
            <tr>
                <td>@ticket.TicketNumber</td>
                <td>@(ticket.Student?.FullName ?? "Deleted Student")</td>
                <td>
                    @if (ticket.WasSkipped)
                    {
                        <span class="badge bg-warning text-dark">Skipped</span>
                    }
                    else if (ticket.IsCalled)
                    {
                        <span class="badge bg-success">Called</span>
                    }
                    else
                    {
                        <span class="badge bg-secondary">Waiting</span>
                    }
                </td>
                <td>
                    @if (!ticket.IsCalled)
                    {
                        <a asp-action="CallNext" asp-route-ticketId="@ticket.Id" class="btn btn-success">Call</a>
                        <a asp-action="SkipTicket" asp-route-ticketId="@ticket.Id" class="btn btn-danger">Skip</a>
                    }
                </td>
            </tr>
        }

    </tbody>
</table>


<!-- Skipped Tickets Modal -->
<div class="modal fade" id="skippedModal" tabindex="-1" aria-labelledby="skippedModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="skippedModalLabel">Skipped Tickets (Today)</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                @if (ViewBag.SkippedTickets != null && ((List<QueueTicket>)ViewBag.SkippedTickets).Any())
                {
                    <table class="table table-bordered table-striped">
                        <thead>
                            <tr>
                                <th>Ticket Number</th>
                                <th>Student Name</th>
                                <th>Skipped Time</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var ticket in (List<QueueTicket>)ViewBag.SkippedTickets)
                            {
                                <tr>
                                    <td>@ticket.TicketNumber</td>
                                    <td>@(ticket.Student?.FullName ?? "Deleted Student")</td>
                                    <td>@ticket.CreatedAt.ToString("hh:mm tt")</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <p class="text-muted">No skipped tickets for today.</p>
                }
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>



